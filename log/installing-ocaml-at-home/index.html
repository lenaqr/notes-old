<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Installing OCaml at&nbsp;home | Anthony Lu</title>
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Merriweather" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//luanths.github.io/theme/base.css" />
    <link href="//luanths.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Anthony Lu Full Atom Feed" />





  </head>
  <body>
    <header id="header">
      <nav id="navigation">
        <a href="/about/">About</a>
        <a href="/log/">Log</a>
      </nav>
    </header>

    <section id="content">
  <header>
    <h1 class="entry-title">
      <a href="//luanths.github.io/log/installing-ocaml-at-home/" rel="bookmark"
         title="Permalink to Installing OCaml atÂ home">Installing OCaml at&nbsp;home</a></h2>
 
  </header>
  <div class="entry-content">
    <p>I write OCaml code in my day job, where we&#8217;ve invested in a developer experience that works out of the box with the right tools, compilers, and editor&nbsp;plugins.</p>
<p>To use OCaml at home, there&#8217;s a bit more setup. I mostly followed the instructions in <a href="https://dev.realworldocaml.org/install.html">Real World Ocaml</a>, but there were a couple places where it seemed out of date and I ended up doing something different, so I&#8217;ve written up what I did&nbsp;here.</p>


<p>I started by installing <a href="https://opam.ocaml.org/">opam</a>. Since I run Arch Linux, I did this with <code>pacman -S opam</code>.</p>
<p>I also enabled the <a href="https://github.com/syl20bnr/spacemacs/tree/master/layers/%2Blang/ocaml">Spacemacs layer for OCaml</a>.</p>
<p>Then, following the opam instructions, I initialized the package database and installed some basic libraries and&nbsp;tools.</p>
<div class="highlight"><pre><span></span><code><span class="err">opam init</span>
<span class="err">eval $(opam env)</span>
<span class="err">opam install core utop merlin ocp-indent dune</span>
</code></pre></div>


<p>One gotcha: <code>utop</code> depends on <code>lwt</code>, which fails to compile unless the system library <code>libev</code> is installed. So I had to <code>pacman -S libev</code>.</p>
<p>At this point I realized that, since I was used to running everything from Emacs, <code>eval $(opam env)</code> wouldn&#8217;t do what I wanted since it only activates the opam environment in my shell. After a bit of searching around, I arrived at this elisp function to activate opam in&nbsp;Emacs.</p>
<div class="highlight"><pre><span></span><code><span class="err">(defun opam-env ()</span>
<span class="err">  (interactive nil)</span>
<span class="err">  (add-to-list &#39;exec-path (replace-regexp-in-string &quot;\n\\&#39;&quot; &quot;&quot; (shell-command-to-string &quot;opam config var bin&quot;)))</span>
<span class="err">    (dolist (var (car (read-from-string (shell-command-to-string &quot;opam env --sexp&quot;))))</span>
<span class="err">      (setenv (car var) (cadr var))))</span>
</code></pre></div>


<p>In retrospect, I suppose I could&#8217;ve also run <code>eval $(opam env)</code> in a shell and then launched Emacs, but this works for&nbsp;me.</p>
<p>Anyway, at this point I&#8217;m ready to start a coding project. Using <a href="https://dune.build/">dune</a>:</p>
<div class="highlight"><pre><span></span><code><span class="err">dune init proj myproj --libs core</span>
</code></pre></div>


<p>This generates a little project structure, and I can open up <code>myproj/bin/main.ml</code> and start coding. To build the project, I&nbsp;run</p>
<div class="highlight"><pre><span></span><code><span class="err">dune build -w</span>
</code></pre></div>


<p>which recompiles whenever I save, and now I&#8217;m off to the&nbsp;races.</p>
  </div><!-- /.entry-content -->
  <footer class="post-info">
    <time class="published" datetime="2020-02-13T00:00:00-05:00">
      February 2020
    </time>
  </footer><!-- /.post-info -->
    </section>

    <fooder id="footer">
      Site generated by
      <a href="http://getpelican.com/">Pelican</a>
      and hosted by
      <a href="http://pages.github.com/">GitHub Pages</a>
    </footer>
  </body>
</html>